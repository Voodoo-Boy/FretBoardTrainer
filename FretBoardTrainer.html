<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Fret Board Trainer</title>
	<link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah" rel="stylesheet">
	<style>
		body
		{
			font-family: 'Gloria Hallelujah', sans-serif;
			font-size: 18px;
			font-display: fallback;
			letter-spacing: 0.05em;
		}
	</style>
</head>

<body>
	<!-- Titile -->
	<div style="font-size: 32px;"><b>Fret Board Trainer</b></div>
	<!-- Invisible Audio Player -->
	<audio src="https://translate.google.com/translate_tts?ie=UTF-8&tl=en-us&client=tw-ob&q=foo" id="GoogleTTS" hidden></audio>
	<audio src="http://tts.baidu.com/text2audio?lan=en&ie=utf-8&text=foo" id="BaiduTTS" hidden></audio>
	<p></p>

	<!-- Setting -->
	<div style="font-size: 24px;"><b>Setting</b></div>
	<!-- TTS Vendor -->
	<div>
		<b>SPEAKER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>
		<wired-radio-group selected="Google" onclick="VendorChangeHandler(this)">
			<wired-radio name="Google" text="Google"></wired-radio>
			<wired-radio name="Baidu" text="Baidu"></wired-radio>
		</wired-radio-group>
	</div>
	<!-- Mode Selection -->
	<div>
		<b>MODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>
		<wired-radio-group selected="Single" onclick="ModeChangeHandler(this)">
			<wired-radio name="Single" text="Single Note"></wired-radio>
			<wired-radio name="Sequential" text="Sequential"></wired-radio>
		</wired-radio-group>
	</div>
	<!-- Signature Selection -->
	<div>
		<b>NOSIG</b>(#, b)&nbsp;&nbsp;&nbsp;&nbsp;
		<wired-toggle checked onclick="NoSigChangeHandler(this)"></wired-toggle>
	</div>
	<!-- Speed of sequential trainning -->
	<div>
		<b>Speed</b>(1.0~10.0)&nbsp;&nbsp;
		<wired-input style="font-family: 'Gloria Hallelujah', sans-serif;font-size: 20px;" value="4.0" id="SpeedInput" onkeydown="SpeedInputChangeHandler(this, event)"></wired-input>
	</div>
	<p></p>

	<!-- Control and Display aera -->
	<div style="font-size: 24px;"><b>Trainer</b></div>
	<!-- Buttons -->
	<wired-button onclick="PlayNote()" elevation="3">Play</wired-button>
	<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
	<wired-button onclick="StopSeq()" elevation="3" id="StopButton" disabled>Stop</wired-button>
	<p></p>
	<!-- "LCD" -->
	<div>
		<wired-card style="font-size: 44px;" id="LCD">&nbsp;&nbsp;&nbsp;&nbsp;</wired-card>
	</div>
</body>

<script src="https://unpkg.com/wired-elements@latest/dist/wired-elements.bundled.min.js"></script>
<script>
	// Initailization
	const NOTES = [ "A", "B", "C", "D", "E", "F", "G" ];
	const SYMBOLS = [ "sharp", "flat", "" ];
	const GOOGLE_TTS_URL = "https://translate.google.com/translate_tts?ie=UTF-8&tl=en-us&client=tw-ob&q=";
	const BAIDU_TTS_URL = "http://tts.baidu.com/text2audio?lan=en&ie=utf-8&text=";
	const MAX_SPEED = 10.0;
	const MIN_SPEED = 1.0;
	var MODE = "SINGLE";
	var VENDOR = "GOOGLE";
	var NoSig = true;
	var ReadSpeed = 4.0;
	var SeqPlaying = false;
	var LastPlayTime = -1;
	setTimeout(PlaySeq, 50);

	// Set key down event listener.
	document.addEventListener('keydown', (event) =>
	{
		// KeyCode of <Space> == 32.
		if (event.keyCode == 32) PlayNote();
	});

	function VendorChangeHandler(vendors)
	{
		if (vendors.childNodes[1].checked) VENDOR = "GOOGLE";
		else VENDOR = "BAIDU";
	}

	function ModeChangeHandler(modes)
	{
		if (modes.childNodes[1].checked) MODE = "SINGLE";
		else MODE = "SEQUENTIAL";

		if (MODE == "SINGLE") document.getElementById("StopButton").disabled = true;
		else document.getElementById("StopButton").disabled = false	;
	}

	function NoSigChangeHandler(toggle)
	{
		NoSig = (!(toggle.checked == false));
	}

	function SpeedInputChangeHandler(input, event)
	{
		// KeyCode of <Enter> == 13.
		if (event.keyCode == 13)
		{
			let speed = parseFloat(input.value);
			if (speed >= MIN_SPEED && speed <= MAX_SPEED) ReadSpeed = speed;
			else input.value = Number.parseFloat(ReadSpeed).toFixed(1);
		}
	}

	function RandomNote()
	{
		return NOTES[Math.floor(Math.random() * NOTES.length)];
	}

	function RandomSymbol()
	{
		return SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
	}

	function PlayNote()
	{
		if (MODE == "SINGLE") PlaySingle();
		else SeqPlaying = true;
	}

	function PlaySingle()
	{
		let Note = RandomNote();
		let Symbol = RandomSymbol();
		let Url = (VENDOR == "GOOGLE" ? GOOGLE_TTS_URL : BAIDU_TTS_URL) + Note;
		if (!NoSig)
		{
			if (Symbol != "") Url = Url + "+" + Symbol;
		}

		let SpeakerId = (VENDOR == "GOOGLE" ? "GoogleTTS" : "BaiduTTS");
		let Speaker = document.getElementById(SpeakerId);
		Speaker.setAttribute("src", Url);

		let LCD = document.getElementById("LCD");
		if (Symbol == "sharp") Symbol = "#";
		else if (Symbol == "flat") Symbol = "b";
		else Symbol = "";
		let NoteToDisplay = Note;
		if (!NoSig) NoteToDisplay = NoteToDisplay + Symbol;
		LCD.innerHTML = NoteToDisplay;
		Speaker.play();
	}

	function PlaySeq()
	{
		if (SeqPlaying)
		{
			let CurTime = Date.now();
			if (LastPlayTime < 0)
			{
				PlaySingle();
				LastPlayTime = CurTime;
			}
			else
			{
				if (CurTime - LastPlayTime > ReadSpeed * 1000)
				{
					PlaySingle();
					LastPlayTime = CurTime;
				}
			}
		}

		setTimeout(PlaySeq, 50);
	}

	function StopSeq()
	{
		SeqPlaying = false;
	}

</script>

